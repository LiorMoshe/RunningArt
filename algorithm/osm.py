import geopy
import overpy
from geopy.distance import geodesic

# server_url = "http://52.56.65.199/api/interpreter"
server_url = "https://overpass.kumi.systems/api/interpreter"


def bbox_calculation(location_node, km_distance):
    destination = geopy.distance.distance(kilometers=km_distance).destination((location_node[0],location_node[1]), 180)
    south_lat, south_long = destination.latitude, destination.longitude
    destination = geopy.distance.distance(kilometers=km_distance).destination((location_node[0],location_node[1]), 0)
    north_lat, north_long = destination.latitude, destination.longitude
    destination = geopy.distance.distance(kilometers=km_distance).destination((location_node[0],location_node[1]), 90)
    east_lat, east_long = destination.latitude, destination.longitude
    destination = geopy.distance.distance(kilometers=km_distance).destination((location_node[0],location_node[1]), 270)
    west_lat, west_long = destination.latitude, destination.longitude
    return south_lat, west_long, north_lat, east_long


def get_intersection_nodes_idx(location_node, km_distance, file=True):
    if file:
        node_indexes = []
        for idx in ['472591143', '472591146', '1199373039', '3668921343', '540439101', '2266143464', '978389307', '1199373028', '1199373036', '1931861639', '1199373034', '1199373061', '1931861633', '318759301', '472591207', '318759295', '2217011844', '2515962061', '2217011846', '318758392', '540439204', '2515962037', '318759300', '1931841483', '2365358068', '268217756', '472591106', '472591148', '1931844453', '2558916051', '2558916053', '1199373065', '1931861658', '1931861671', '3668921327', '6488204572', '540433477', '3524113313', '4637004586', '2217011855', '2515962030', '6454361105', '1200005659', '1200005681', '6454785112', '6454785113', '6454785115', '6454785116', '6454785117', '6454785129', '6454785137', '6454785145', '6454785149', '6454785154', '6454785156', '2266143484', '2515962036', '6454784771', '6454785114', '6454785140', '6454785144', '6454785155', '6454785159', '540437491', '540437774', '472591134', '540438324', '540438325', '540438326', '540438328', '2216140845', '540437723', '540437762', '540438827', '540439020', '799423519', '2216120256', '2216140843', '2216956972', '2266143428', '2266143438', '2266143457', '2266143462', '2266143467', '6516011908', '1931844390', '1931844416', '1931844420', '1931844429', '1931844466', '1931844414', '1931844467', '1931844469', '7067508722', '1931844391', '1931844408', '1931844428', '1931844396', '1931844394', '472591128', '514532018', '514541475', '1931844386', '2515962034', '2515962046', '1200005649', '1200005679', '1200005689', '2216140838', '6362689602', '1931844433', '6017732744', '2515962027', '2515962055', '2217011847', '2515962059', '2515962038', '2365358069', '1143763279', '268217771', '318762050', '2216929183', '2216956973', '2266143436', '3771708550', '3909311113', '6989513263', '357533792', '540433475', '1143770964', '2216978327', '2515962044', '3771708549', '540432924', '1143770888', '1953544988', '2216970907', '2216970909', '390266211', '515877139', '1143770896', '1566055193', '1575611075', '540432944', '540433176', '540433472', '540435510', '2216964347', '6035020759', '540433473', '540433635', '540434265', '540434379', '540434571', '2515962041', '540434433', '540436506', '268217769', '286542230', '286544728', '286643406', '286692486', '338659016', '549268178', '591891217', '1566056268', '1574692708', '1574692724', '1574692796', '1574692830', '4134443793', '4134443794', '4165518783', '4134443792', '1574692863', '1574692777', '1574692585', '1574692749', '1574692813', '4134443819', '1449561809', '515877404', '515877406', '1574692755', '5933619196', '1143770931', '1953544982', '318867658', '409835472', '2216964312', '2216964345', '2216978328', '2618788152', '2618788153', '318867646', '409835471', '540447618', '1575611204', '1931837029', '2216964306', '2216964326', '2216978329', '3531593251', '286542661', '549268900', '549271108', '1571763695', '1571764151', '1574692739', '1574692753', '1574692851', '1574692853', '2133458885', '2225766256', '2470035518', '3909303375', '1574692716', '540431794', '540434378', '540434578', '799420454', '1645591870', '2515962026', '3771708548', '4715570345', '1574692546', '1574692731', '1574692820', '1574692905', '6035020755', '2216978324', '540435293', '540436609', '540439278', '1931836997', '318867560', '318867661', '2216956975', '2216978332', '6154187445', '6989513267', '2216978333', '2216988420', '6989513269', '1574692554', '6035020757', '2216964297', '2216964310', '549254120', '2216964355', '2618775117', '338658900', '549268888', '549271107', '1568022419', '1568022447', '1568022484', '1571656353', '1571656390', '1571656402', '1571656429', '1571656449', '1571656575', '1571656579', '1571656641', '1571656673', '1571763626', '1571764159', '1571764243', '1574692790', '1574692870', '1683208868', '1627609', '286643379', '566890495', '591891306', '1627613', '1627615', '6187417336', '549267521', '549267539', '549267544', '549269124', '1569154963', '1571656418', '4131676718', '549267901', '549267988', '549268021', '1568022547', '1571656394', '2995640305', '1568022373', '1568022537', '1568022563', '1568022606', '1568022485', '1568022401', '1568022550', '4165519902', '1568022386', '1568022418', '1569154971', '1569154981', '4064096512', '549268341', '1571656318', '1784523536', '1121649535', '2995641085', '1566055928', '1950487594', '2657949196', '4165518776', '3994469000', '3994469001', '200661227', '1121649567', '4165518778', '4165518779', '1568022437', '4165518782', '1571656126', '4064096513', '540424525', '1566055462', '1568022370', '1568022392', '1568022456', '1568022457', '4131676722', '1566055931', '540425904', '549256536', '549257035', '1566055007', '1566055761', '1566055935', '1568022489', '1568022477', '1568022610', '1568022429', '1568022557', '1568022618', '1950487590', '286544166', '591891227', '2995641124', '2995641141', '2995641113', '1569154972', '1569154989', '4520938052', '3994468992', '3994468993', '3994468999', '4520945911', '4520945912', '1199976556', '1199976577', '1199976595', '4139634009', '4139634011', '6454376359', '3146936635', '3992078704', '580718144', '5928155241', '6496211524', '357529280', '357529281', '357531366', '357531421', '1931861635', '1931861662', '357531339', '357531232', '472591153', '1199970829', '1528637190', '6496211520', '6496211521', '6496211522', '6502045903', '365766257', '1199976572', '6502045907', '580720127', '3992078710', '472591136', '3668921328', '472591151', '472591152', '1199953225', '4131740929', '6175760502', '6496211519', '580743786', '580745794', '799422258', '1931861654', '1931861665', '1931861696', '1931861702', '2112530139', '1931861666', '286542729', '1199953175', '1199953193', '1199953205', '3773336616', '6175760503', '580714057', '580715602', '580715812', '580717677', '580742984', '6454785106', '580718790', '580718921', '580718792', '580718794', '4131740925', '978369645', '580721097', '3774173470', '365769156', '580726367', '1198051934', '1199953208', '1199956977', '4131740918', '5958785290', '4131740917', '6488204570', '1199956973', '681665116', '1200005639', '978369629', '978369634', '1199373010', '3295315589', '4716344840', '4716344842', '978369667', '978369670', '978369673', '978369654', '978369688', '978369692', '978369709', '978369739', '440282892', '978369711', '1200005710', '1199953215', '1199953223', '6496211526', '1199953176', '1199953189', '6502043971', '6502045904', '1199953162', '1199953167', '1199956978', '5958785286', '1199953197', '4970950149', '4970950150', '1199953169', '1199953200', '1199956971', '1199953182', '6030300138', '6154187427', '6154187428', '1199976559', '1199976575', '1199976578', '1199976582', '1199953165', '357521087', '3774173466', '3992078707', '1208799519', '3773336621', '1931861701', '1931861661', '1200005647', '6488204574', '6153833358', '2493918000', '1953545064', '1953545067', '1200005655', '2493917999', '357533356', '2613354232', '3773336617', '6496211517', '3774173457', '3992078708', '3668921329', '3773336618', '3773336619', '2112530141', '3774173463', '3774173464', '3774173467', '1199953171', '4139634008', '6454785101', '4139634010', '6454785100', '4139634014', '4716344839', '4716344841', '978369656', '1062445971', '5928155226', '5928553630', '1199976594', '4141007002', '357533625', '2266173318', '6164336822', '6175760506', '3915427029', '580743782', '6454784739', '6454785091', '6454784753', '6454784777', '1199976580', '6501632938', '6501632939', '2584166679', '6502045906', '2584166686', '365766891', '924450733', '924450764', '6154187425', '357533360', '1198469083', '1198542024', '1856841346', '724191521', '1200021239', '1953545098', '2509747192', '365769152', '580723068', '580725909', '580726702', '1198051849', '1198051901', '580714365', '580714979', '1208799500', '440062859', '2383595033', '6566105107', '4715010762', '357534734', '1435925458', '1931841474', '440062857', '724192875', '1200005654', '1724608540', '2532326754', '580714987', '1931841493', '2396609094', '2470035562', '1208799508', '2266173319', '6164336825', '6454376352', '1953545075', '978358922', '5928553624', '472591158', '5928553650', '5928553657', '1143770884', '1208799504', '1931841504', '2470035561', '705536611', '1208799499', '2470061865', '2470061873', '4141006990', '7843602191', '357556865', '1203668142', '1950416393', '2141534223', '2532326748', '1200021235', '1200021267', '1953545085', '6154187438', '1953545087', '6454784752', '6945224911', '4795114603', '6945224912', '4715570338', '4715570340', '4715570342', '357534839', '1143770921', '1143770935', '1931841500', '3556339840', '5180414655', '357534881', '357535066', '1931841485', '1950406018', '5180414648', '6753379311', '540430406', '540430472', '540431630', '540431795', '1143770908', '7704552120', '514354787', '580709102', '365768007', '580710939', '580706957', '580713872', '1143770881', '1143770907', '1232931879', '2112533191', '1931841490', '1208799483', '1208799532', '1208799485', '870887834', '1208799481', '1208799502', '1232931882', '1931841498', '1143770950', '4715570339', '1953545032', '580704870', '580705409', '4139634059', '2217031271', '2217040457', '2217040462', '870887825', '870887828', '2381515598', '2470035560', '2493918001', '2493918006', '4139634056', '318761485', '4715570341', '5808171976', '6137993426', '580709327', '6952780393', '286643465', '357545243', '540419958', '4134443831', '540426350', '540426351', '540426372', '540426698', '286643492', '799418395', '286643421', '286643424', '2437718004', '3698767279', '540427737', '540431102', '540431353', '799419132', '6185696562', '6185696563', '540427864', '540429611', '540429906', '540429939', '540430239', '540430271', '540431140', '540430952', '540431326', '540431354', '540431406', '1574692656', '1574692726', '1574692929', '1574692603', '1574692685', '1574692602', '4134443828', '1628430694', '1628430716', '286543443', '357535535', '357535894', '540420265', '799417353', '4582891013', '286643494', '540431071', '2383595017', '2567910218', '2641923404', '1953544992', '1953545008', '1953545000', '1953545026', '1953545006', '1953544997', '1574692654', '1617025423', '2469958094', '3725505595', '1143770958', '2437717824', '2437717857', '2622735661', '2622735662', '286741983', '540427220', '3725505594', '286542525', '2470035540', '2470035541', '2473291429', '540426692', '334738489', '3698767277', '1574692600', '4134443836', '1574692632', '4714893624', '540430951', '357500272', '1628430724', '2469958092', '2470061831', '2470061832', '286643475', '317214411', '366653136', '799417137', '286643440', '286643458', '286643460', '366651300', '366652380', '366652746', '366653067', '366653799', '1571764097', '1628430688', '1628430723', '4170418930', '384674447', '384675741', '384676006', '384726502', '1319999663', '1319999678', '1319999680', '1319999683', '1320003468', '1628415533', '2268450648', '6427502028', '357498733', '365768345', '384667998', '384668147', '365767997', '514350359', '514357167', '580712059', '580713243', '3999875641', '4170418936', '5854741476', '5854741482', '365768426', '365768435', '384675878', '412524677', '412528048', '412528770', '412530016', '412531396', '496175461', '579601924', '681554282', '681555854', '1319999687', '1383600399', '1628415535', '2108063323', '2133476077', '3985298562', '366652962', '540420234', '540420291', '7534476419', '366654065', '366654066', '540419840', '384674784', '384674787', '384675853', '2274162150', '3985298558', '384674961', '384674962', '384730662', '496175385', '5957905807', '384675965', '496175387', '384675739', '412530001', '412530195', '357492752', '357493840', '440059978', '1724608591', '1724608605', '412528771', '3985298563', '286542526', '580709623', '580710450', '2108063257', '2862997451', '406399586', '540419838', '540419855', '1574692678', '2294948482', '2469958097', '1574692643', '1574692892', '279713608', '412528707', '3985298561', '3593580026', '3593580051', '580704387', '580706963', '2108063253', '514353823', '580709980', '2862997454', '2532326750', '440062849', '1083453617', '1083454176', '1320003464', '1383600407', '1383600416', '317214579', '1383600402', '1628415510', '2133476079', '3985298557', '1383600403', '1383600413', '1383600400', '1383600412', '549270589', '549271109', '1574692800', '2469958098', '1574692797', '1574692653', '1574692732', '1574692856', '1574692795', '1574692885', '1574692580', '1574692741', '1574692751', '2133458880', '2133458882', '514355655', '1672351158', '580706970', '2108063278', '580706967', '580712058', '580712186', '57046723', '357489295', '1724608651', '496176455', '1571656217', '2470035520', '7276228507', '1574692746', '1574692918', '286542239', '286754329', '496176171', '7534476415', '6137993453', '2862997452', '2862997457', '3684265364', '3684265368', '1941634809', '2683100017', '2469975173', '3678367016', '3678367017', '3684265363', '3684265365', '3736253835', '3736253834', '3985298559', '3985298565', '2469958099', '2469958100', '2469958101', '2496365135', '2496425247', '412530340', '412531323', '4139634023', '580709110', '1672351167', '6137993452', '2108063290', '2108063293', '496176315', '412527669', '412531507', '279713616', '286643420', '317214577', '4010257615', '4010257616', '334739161', '2496365161', '1941637466', '3667593239', '1574692874', '5071198350', '366653165', '366653693', '1628430719', '34650800', '384648219', '384651116', '4014929254', '334739043', '57046702', '57046703', '579603495', '681556771', '1203668156', '1628415525', '2383595014', '2383595023', '357489690', '1724608588', '2108063277', '412527706', '412530569', '412531260', '412534016', '496175946', '3593580049', '412525198', '2108063282', '5958477391', '412531452', '412531506', '412531901', '412532283', '576978980', '2108063320', '580711310', '580712185', '579601793', '681556436', '3593580054', '5957905816', '7861549711', '1208799516', '5854741478', '1319999684', '1208799525', '3593580055', '580707524', '2108063322', '412524678', '2108063287', '2108063286', '2141534228', '2532326740', '2532326747', '2532326752', '2532326718', '2532326744', '2532326758', '3593580050', '1383607564', '5854741474', '6269788101', '7058610554', '540421284', '540421320', '1628430692', '286643451', '357536696', '366651462', '286643444', '366651463', '340235293', '3593580027', '357538387', '357538922', '357536485', '357499603', '2133470403', '2852284480', '2852284483', '4010257614', '4010335306', '6984903916', '366649858', '2470061851', '366651303', '366651349', '496176172', '540420824', '366652262', '366652516', '496176174', '2139244077', '2470061834', '2108063292', '384694639', '384695042', '412528202', '1383600404', '1383600414', '1628430689', '1628430687', '1628430710', '1628430720', '1995922116', '1995922128', '1995922151', '2139243366', '2133478738', '2133470404', '2133478739', '412522566', '496176177', '2139243359', '2470061835', '2470061837', '5243260057', '2139243362', '2139244073', '2139244074', '7052661053', '514357166', '7769885849', '317214414', '317214418', '334719605', '384773322', '286643432', '4833025980', '540422648', '549268886', '1568022473', '1571656101', '1571656214', '1571656551', '1568022409', '1568022470', '549268582', '549268584', '549269036', '549269609', '1784523542', '1571656326', '1571656499', '1571656573', '1571656619', '549271104', '1571763624', '1571763771', '1568022453', '1571656057', '1571656553', '1568022518', '1571656392', '1571656422', '1571656577', '1571656289', '1571656331', '1571656330', '1571656393', '1571656588', '1571656420', '1571656397', '549269607', '1571656170', '1571656007', '1571656685', '1571656363', '1571656538', '1571656678', '1571763570', '1911081888', '1571763825', '1571763907', '1571763963', '1571764197', '1571763960', '1571764066', '4253794363', '1571764003', '1574692916', '2133458881', '2470035528', '1571656446', '1784523538', '1571655983', '2470035532', '1122432777', '1467329572', '3999787162', '3999787164', '4118617711', '549269610', '1571656328', '1571656459', '1571656550', '1122432749', '1467329566', '2978225372', '2978225390', '4118617709', '4216009128', '6134833702', '1531420160', '33956079', '33956082', '2493584617', '5596652341', '5596652342', '6137358182', '1531420177', '34651078', '1234762968', '1571656581', '1571656287', '1571656623', '1571656251', '1571656621', '1571656053', '1571656174', '2493584635', '1571656241', '1571656582', '1571656513', '1571656024', '983958276', '6137358688', '1574582479', '1790662868', '1790662870', '1790662866', '1571656514', '1790662864', '33956080', '2493918012', '2493584577', '3999780947', '2390930262', '2493584573', '2493584650', '2493584662', '4108458909', '4064096511', '983958278', '34651075', '3992798245', '289503068', '412816227', '412816550', '3644526489', '984206018', '1234762861', '1574582406', '1574582419', '4017282098', '681570928', '681572534', '939855204', '34651077', '983958273', '984158853', '5194536394', '5194536395', '6095670906', '359023410', '984158867', '984158861', '1574692706', '286546123', '1571656311', '939855181', '983958272', '1574582418', '1574582425', '1574582460', '1574582517', '1574582615', '2225805229', '352905165', '352905167', '1122432830', '5029581494', '5029581500', '3699173893', '3699173904', '3699173905', '3745844690', '3914294053', '1234762966', '1272411978', '1574582513', '1574582628', '2374499617', '3699173886', '2493584585', '2296995677', '540421708', '681517402', '681578494', '1574692729', '1234762916', '1574582446', '1953636954', '2122980995', '4017282099', '1121649521', '1234762937', '1574582458', '289502961', '939855179', '1272411980', '2496365203', '2761630270', '3699173878', '1574582596', '3678367011', '3699173896', '3699173917', '3667593228', '4874729988', '3644526490', '340235519', '4227296478', '3667593236', '4215688468', '4082010211', '5029581497', '3667593241', '33388554', '1187703911', '6420376496', '6420450325', '4084752266', '6420450332', '6420450333', '2327294774', '6754358807', '540454491', '338660371', '1574582410', '282458259', '540455192', '4050214078', '7769840900', '286741982', '939855205', '1574692912', '681517078', '681577141', '1574692718', '2122981002', '540418391', '1574692781', '1574692809', '3854246820', '1574692788', '3678367021', '681517403', '2142261185', '939855184', '939855189', '939855195', '939855186', '3699173883', '939855185', '1574582531', '2365353818', '6438739026', '4253794366', '1234762967', '540418426', '1574582502', '1571763865', '1574582578', '34651074', '282458212', '1574582521', '1574582624', '1574582646', '1574692660', '2225797387', '6095670909', '1574692888', '1574692681', '2365353786', '2365353816', '2365353846', '1234762955', '2365353763', '7769836014', '3678367015', '3678367019', '4618217903', '4618217904', '3822572288', '3822572290', '3992803577', '6095670907', '1234762883', '1234762930', '1234762938', '3699173870', '6041090849', '289503064', '289503319', '289503541', '4017282123', '3699173847', '3699173862', '289503065', '289503947', '1790662886', '3699173876', '4017282120', '984158857', '1574582562', '1234762905', '2373734838', '3406707383', '1234762886', '1953637013', '1234762870', '1234762951', '1272411979', '1342949242', '3872001894', '1574582542', '2122980982', '286763487', '289503067', '1234762956', '1790662883', '3871956300', '1234762909', '1790662878', '1790662884', '3739773085', '1234762962', '1234762903', '6139395796', '1234762917', '3739773083', '1987571695', '1234762935', '1688194246', '1234762865', '3644526483', '3699173848', '1272411998', '4017282096', '4017282126', '4017282124', '4017282095', '3985298579', '357493795', '4139634029', '357493148', '384675578', '3985298582', '7056968251', '384759545', '3985298578', '315468518', '902736435', '549237512', '549237564', '549237566', '440062846', '440062847', '2160093352', '902736436', '549232724', '937839291', '3621265272', '3985298576', '1628415504', '4013462837', '315468517', '476387543', '357491441', '3985298575', '3985298592', '1724608656', '1724608653', '384675482', '2141532006', '6269788099', '33617427', '3985298595', '384668105', '7056968256', '384730905', '1628415541', '2109540860', '3188318588', '4637525327', '6169883778', '6169883781', '679324056', '2109540812', '2109540814', '3725505596', '33388430', '57046731', '539658707', '1628174331', '1701344419', '1930915645', '1930915646', '1930915647', '1930915652', '1930915654', '4637515476', '5857411491', '5857411492', '6487755172', '57046734', '57046735', '384670581', '384671148', '384673698', '334740172', '279713591', '3612842299', '4010257603', '287570531', '287570954', '384650163', '1683208870', '2469958071', '357518611', '357518612', '384669147', '2365353783', '384640695', '384644922', '2469848118', '384648823', '384649099', '384655119', '384655261', '384671144', '384669173', '384670833', '384673348', '384669178', '384731941', '3188318589', '1628415505', '3659571732', '3659571733', '412521760', '412521761', '412521763', '384682788', '440059997', '440059998', '440059999', '440060001', '440060003', '440060005', '539632333', '440060011', '440060012', '539636482', '549230649', '549230654', '539638640', '539656397', '549237320', '1628174263', '1628174335', '440060029', '549230993', '1628174243', '1628174304', '1628174441', '5857411493', '3188307469', '3188307470', '3188318590', '4018542421', '1628415509', '1628415520', '287572295', '1941637481', '2109540861', '2139853818', '2496365195', '549237413', '279713588', '476389622', '384676600', '2469958073', '4018510527', '3612841892', '3612842293', '4018510522', '4018510534', '3985298566', '4018510533', '4018510529', '4018510530', '4018510531', '4018510532', '4637515475', '7534151841', '1628415522', '2496365141', '440060013', '2469848119', '282458089', '282458093', '282458158', '384639223', '384639549', '384651123', '384662487', '384663290', '384664973', '384741725', '476389032', '496175245', '2144017077', '7768335018', '334710148', '334710405', '334710408', '334711446', '384655862', '384685855', '384687440', '2469848115', '4849664926', '5873048858', '315468519', '384678214', '384679001', '440059964', '440059966', '539641899', '539655513', '549232384', '549232875', '549236095', '549236100', '549239612', '5959043985', '287571173', '384653020', '384660226', '496175198', '1184173364', '3992803565', '384732671', '384732672', '384654416', '384719374', '384632413', '384636414', '384637410', '384639051', '384639342', '384651125', '412521186', '384656323', '384741724', '2469848068', '3307421769', '4085740739', '384661228', '1628415537', '384683898', '384684113', '549231325', '2469958069', '539617401', '539625937', '539628947', '539627326', '539628955', '539634987', '539642223', '440060015', '440060016', '539654214', '549232988', '549236716', '539625980', '440060036', '539655506', '549233143', '549236700', '549237409', '440062871', '549239503', '539628367', '539628952', '539619086', '440060035', '539655499', '549233531', '549232986', '549236704', '549237411', '549233323', '549233516', '549236695', '549237407', '332206685', '334709788', '384658095', '384658418', '384662488', '384663084', '1342959838', '2144017081', '2469848073', '2931418488', '4178746392', '2469848089', '2469848114', '4085740740', '5923748603', '5923748609', '5923748610', '287572290', '311001060', '311001062', '384653019', '384660615', '384741761', '1643308435', '311001030', '311001040', '311001044', '311001058', '355602971', '384648220', '384651121', '3992803564', '4014929253', '1701344389', '384677991', '440059970', '549241440', '2141489085', '384677768', '3987152341', '4018542415', '2144017096', '2469848066', '2469848074', '2469848076', '2469848079', '3307421768', '7769911996', '384686796', '3987152340', '5923748608', '3988271551', '33388446', '549240225', '3987152342', '282458079', '283612318', '384653018', '384741759', '1187703954', '2469958049', '5923748619', '6065966319', '334711448', '384677576', '4023817515', '3987152337', '539626016', '384656319', '7052025163', '7052025164', '3987152307', '3987152308', '3987152324', '412521602', '384687032', '384687040', '7052025165', '315468520', '384609469', '3992803566', '384622257', '4475762404', '384622740', '384622743', '384637413', '384636415', '384660612', '384660757', '384654737', '1187703963', '1187703941', '4875389967', '4875389991', '1187703953', '1187703909', '476379129', '1897895736', '1897895749', '282458173', '3594844017', '4475762405', '384609471', '3992803567', '384613399', '1683209667', '2508640156', '34650802', '282458047', '282458178', '339468118', '410212795', '339472687', '339472702', '339474687', '367607977', '367608098', '384595167', '3593956982', '3980709602', '339474931', '339474658', '339475875', '339475877', '339476005', '1678949792', '1678949791', '4085651845', '1678949790', '4517981861', '410212890', '1563559694', '3914275806', '2381576084', '1678949818', '1678949806', '3980709597', '1678949808', '2093444674', '2093444772', '6420450329', '282458041', '2384763532', '6100854610', '6649850102', '3686883574', '3686883582', '6141780285', '2503059904', '3686883575', '1678949757', '3694071488', '4204587172', '6099928359', '3699173830', '367608169', '3703608764', '3724244823', '3724244929', '287238465', '4230088535', '4230088540', '4517981867', '3693554634', '4014513958', '2093421793', '3712693698', '6332041748', '3712693700', '4215686691', '3724244931', '3724244935', '3724244943', '7161893975', '3724244815', '3724244936', '3724244939', '2692343459', '3693554663', '4082010253', '339472688', '339475018', '3820683112', '339473381', '3693554665', '3724244937', '4148001311', '4215686694', '4148001299', '7609719031', '6269826304', '2503059916', '2373734830', '6269826300', '6276269922', '6269826302', '282458166', '2374499613', '384581741', '2384763530', '5163546149', '5163546150', '5959457741', '384604871', '384604872', '476376316', '384604490', '384604491', '476376664', '476379062', '384613392', '384613775', '357507801', '384661655', '384664613', '384664614', '384664913', '384661649', '1672351169', '2365353790', '2473987515', '4413855650', '286546719', '1209001015', '2473987505', '34132757', '1672351151', '4413855649', '34132753', '339422118', '3675733112', '3675733261', '3717712396', '1995998509', '2473987507', '440045043', '2088929409', '3693554207', '4523921093', '352934500', '2473987480', '4166597202', '384662490', '384662704', '384663288', '384663621', '2144017079', '1209000995', '384663624', '384664971', '384665045', '2144017091', '2144017093', '2473987482', '4167064566', '286546551', '387494857', '2473987484', '338524359', '338524363', '3601426656', '6515974097', '339422204', '339422212', '1227320', '387493754', '387494926', '2473987489', '387493707', '387493753', '415439840', '387494738', '34132755', '530185823', '3476507815', '3875241454', '3709346594', '3476507813', '3675733262', '3675733263', '530185827', '4000823193', '3697053928', '3717712399']:
            node_indexes.append(int(idx))
        print(node_indexes)
        return node_indexes


    else:
        south_lat, west_long, north_lat, east_long = bbox_calculation(location_node, km_distance)
        api = overpy.Overpass(url=server_url)
        bbox = '<bbox-query e=%s n=%s s=%s w=%s/>' % ('\"'+str(east_long)+'\"','\"'+str(north_lat)+'\"','\"'+str(south_lat)+'\"','\"'+str(west_long)+'\"')
        query = '''
        <osm-script>
    <query type="way" into="hw">
      <has-kv k="highway"/>
      <has-kv k="highway" modv="not" regv="footway|cycleway|path|service|track"/>
       %s 
    </query>
    
    <foreach from="hw" into="w">
      <recurse from="w" type="way-node" into="ns"/>
      <recurse from="ns" type="node-way" into="w2"/>
      <query type="way" into="w2">
        <item set="w2"/>
        <has-kv k="highway"/>
        <has-kv k="highway" modv="not" regv="footway|cycleway|path|service|track"/>
      </query>
      <difference into="wd">
        <item set="w2"/>
        <item set="w"/>
      </difference>
      <recurse from="wd" type="way-node" into="n2"/>
      <recurse from="w"  type="way-node" into="n3"/>
      <query type="node">
        <item set="n2"/>
        <item set="n3"/>
      </query>
      <print/>
    </foreach>
      </osm-script>
        ''' % bbox
        result = api.query(query)
        print(1)
        for node in result.nodes:
            print(node.id)
        return [node.id for node in result.nodes]


def intersection_nodes_with_ways(location_node, km_distance):
    south_lat, west_long, north_lat, east_long = bbox_calculation(location_node,km_distance)
    api = overpy.Overpass(url=server_url)
    bbox = '<bbox-query e=%s n=%s s=%s w=%s/>' % ('\"'+str(east_long)+'\"','\"'+str(north_lat)+'\"','\"'+str(south_lat)+'\"','\"'+str(west_long)+'\"')
    query = """
     <osm-script>
  <union into="_">
    <query into="_" type="way">
          %s
      <has-kv k="highway" modv="" v="residential"/>
    </query>
    <query into="_" type="way">
          %s
      <has-kv k="highway" modv="" v="tertiary"/>
    </query>
        <query into="_" type="way">
          %s
      <has-kv k="highway" modv="" v="pedestrian"/>
    </query>
  </union>
  <print e="" from="_" geometry="skeleton" ids="yes" limit="" mode="meta" n="" order="id" s="" w=""/>
  <recurse from="_" into="_" type="down"/>
  <print e="" from="_" geometry="skeleton" ids="yes" limit="" mode="meta" n="" order="quadtile" s="" w=""/>
</osm-script>
            """ % (bbox, bbox, bbox)
    result = api.query(query)
    return result.ways, result.nodes
